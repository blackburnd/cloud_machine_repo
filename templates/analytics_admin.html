{% extends "base.html" %}

{% block title %}Analytics - Daniel Blackburn{% endblock %}

{% block body_class %}analytics-admin claro{% endblock %}

{% block content %}
<div class="analytics-container">
    <h1>Site Analytics</h1>
    
    <div class="analytics-stats">
        <div class="stat-card">
            <h3>Total Views</h3>
            <div class="stat-number">{{ analytics.total_views }}</div>
            <div class="stat-period">Last {{ analytics.period_days }} days</div>
        </div>
        
        <div class="stat-card">
            <h3>Unique Visitors</h3>
            <div class="stat-number">{{ analytics.unique_visitors }}</div>
            <div class="stat-period">Last {{ analytics.period_days }} days</div>
        </div>
    </div>
    
    <div class="analytics-section">
        <h2>Top Pages</h2>
        <table class="analytics-table">
            <thead>
                <tr>
                    <th>Page</th>
                    <th>Views</th>
                </tr>
            </thead>
            <tbody>
                {% for page in analytics.top_pages %}
                <tr>
                    <td>{{ page.page_path }}</td>
                    <td>{{ page.views }}</td>
                </tr>
                {% endfor %}
                {% if not analytics.top_pages %}
                <tr>
                    <td colspan="2">No data available</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <div class="analytics-section">
        <h2>Recent Visits</h2>
        <table class="analytics-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Page</th>
                    <th>IP Address</th>
                </tr>
            </thead>
            <tbody>
                {% for visit in analytics.recent_visits %}
                <tr>
                    <td>{{ visit.timestamp }}</td>
                    <td>{{ visit.page_path }}</td>
                    <td>{{ visit.ip_address }}</td>
                </tr>
                {% endfor %}
                {% if not analytics.recent_visits %}
                <tr>
                    <td colspan="3">No data available</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <div class="analytics-section">
        <h2>Daily Views</h2>
        <div class="chart-container">
            <canvas id="dailyViewsChart" width="800" height="400"></canvas>
        </div>
    </div>
</div>

<script>
// Simple chart for daily views
const canvas = document.getElementById('dailyViewsChart');
const ctx = canvas.getContext('2d');

const dailyViews = {{ analytics.daily_views | tojson }};

if (dailyViews && dailyViews.length > 0) {
    // Simple bar chart
    const maxViews = Math.max(...dailyViews.map(d => d.views));
    const canvasWidth = canvas.width;
    const canvasHeight = canvas.height;
    const barWidth = canvasWidth / dailyViews.length;
    
    ctx.fillStyle = '#007acc';
    
    dailyViews.forEach((day, index) => {
        const barHeight = (day.views / maxViews) * (canvasHeight - 40);
        const x = index * barWidth;
        const y = canvasHeight - barHeight - 20;
        
        ctx.fillRect(x + 2, y, barWidth - 4, barHeight);
        
        // Add date labels
        ctx.fillStyle = '#333';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(day.date, x + barWidth/2, canvasHeight - 5);
        
        // Add view count
        ctx.fillText(day.views, x + barWidth/2, y - 5);
        
        ctx.fillStyle = '#007acc';
    });
} else {
    ctx.fillStyle = '#666';
    ctx.font = '16px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('No data available', canvas.width/2, canvas.height/2);
}
</script>

<style>
.analytics-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.analytics-stats {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    flex: 1;
}

.stat-number {
    font-size: 2.5em;
    font-weight: bold;
    color: #007acc;
    margin: 10px 0;
}

.stat-period {
    color: #666;
    font-size: 0.9em;
}

.analytics-section {
    margin-bottom: 40px;
}

.analytics-section h2 {
    margin-bottom: 15px;
    color: #333;
}

.analytics-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
}

.analytics-table th,
.analytics-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.analytics-table th {
    background: #f5f5f5;
    font-weight: bold;
}

.analytics-table tr:hover {
    background: #f9f9f9;
}

.chart-container {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
}

#dailyViewsChart {
    border: 1px solid #eee;
}
</style>
{% endblock %}