{% extends "base.html" %}

{% block title %}Analytics - Daniel Blackburn{% endblock %}

{% block body_class %}analytics-admin claro{% endblock %}

{% block content %}
<div class="analytics-container">
    <h1>Site Analytics</h1>
    
    <div class="analytics-stats">
        <div class="stat-card">
            <h3>Total Views</h3>
            <div class="stat-number">{{ analytics.total_views }}</div>
            <div class="stat-period">Last {{ analytics.period_days }} days</div>
        </div>
        
        <div class="stat-card">
            <h3>Unique Visitors</h3>
            <div class="stat-number">{{ analytics.unique_visitors }}</div>
            <div class="stat-period">Last {{ analytics.period_days }} days</div>
        </div>
        
        <div class="stat-card">
            <h3>Human Visitors</h3>
            <div class="stat-number">{{ analytics.human_visitors }}</div>
            <div class="stat-period">Last {{ analytics.period_days }} days</div>
        </div>
    </div>
    
    <div class="analytics-section">
        <h2 class="collapsible-header" onclick="toggleSection('topPages')">
            <span class="toggle-icon" id="topPagesIcon">▼</span>
            Top Pages
        </h2>
        <div id="topPages" class="collapsible-content">
            <table class="analytics-table">
                <thead>
                    <tr>
                        <th>Page</th>
                        <th>Views</th>
                    </tr>
                </thead>
                <tbody>
                    {% for page in analytics.top_pages %}
                    <tr>
                        <td>{{ page.page_path }}</td>
                        <td>{{ page.views }}</td>
                    </tr>
                    {% endfor %}
                    {% if not analytics.top_pages %}
                    <tr>
                        <td colspan="2">No data available</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="analytics-section">
        <h2>Recent Visits</h2>
        <div class="analytics-controls-row compact-controls">
            <input type="text" id="searchBox" placeholder="Search pages, IPs..." class="compact-input" />
            <select id="timeFilter" class="compact-select" title="Time Period">
                <option value="1h">Last Hour</option>
                <option value="24h">Last 24 Hours</option>
                <option value="7d" selected>Last 7 Days</option>
                <option value="30d">Last 30 Days</option>
            </select>
            <button id="clearFiltersBtn" style="display: none;" class="compact-btn" onclick="clearFilters()" title="Clear">✕</button>
        </div>
        
        <div id="searchStatus" class="search-status" style="display: none;"></div>
        
        <div class="analytics-stats compact-stats" id="analyticsStats">
            <span id="totalCount">Total: 0</span>
            <span id="filteredVisits">Loaded: 0</span>
            <span id="uniqueVisitors" class="clickable-stat" onclick="showUniqueVisitorsPopup()" title="Click to view unique visitor details">Unique IPs: 0</span>
        </div>
        
        <div class="analytics-table-container">
            <table class="analytics-table compact-table">
                <thead>
                    <tr>
                        <th data-sort="timestamp" class="sortable compact-th" style="width: 150px;">Date <span class="sort-indicator"></span></th>
                        <th class="compact-th" style="width: 60px;">Age</th>
                        <th data-sort="page_path" class="sortable compact-th" style="width: 35%; min-width: 200px;">Page <span class="sort-indicator"></span></th>
                        <th data-sort="ip_address" class="sortable compact-th" style="width: 120px;">IP Address <span class="sort-indicator"></span></th>
                        <th data-sort="mouse_activity" class="sortable compact-th" style="width: 80px;" title="Human activity detected">Human <span class="sort-indicator"></span></th>
                        <th data-sort="user_agent" class="sortable compact-th" style="width: 20%; min-width: 150px;">User Agent <span class="sort-indicator"></span></th>
                        <th data-sort="referer" class="sortable compact-th" style="width: 15%; min-width: 100px;">Referer <span class="sort-indicator"></span></th>
                    </tr>
                </thead>
                <tbody id="analyticsTableBody">
                    <tr>
                        <td colspan="7" class="loading">Loading visits...</td>
                    </tr>
                </tbody>
            </table>
            <div id="loadingIndicator" class="loading" style="display: none;">Loading more visits...</div>
            <div id="noMoreVisits" class="no-more-logs" style="display: none;">No more visits to load</div>
            <div id="errorMessage" class="error" style="display: none;"></div>
            <div id="scrollTrigger" class="scroll-trigger"></div>
        </div>
    </div>
    
    <div class="analytics-section">
        <h2>Daily Views</h2>
        <p class="chart-description">Shows the number of page views per day over the selected time period. Each bar represents one day's total page views.</p>
        <div class="chart-container">
            <canvas id="dailyViewsChart" width="800" height="400"></canvas>
        </div>
    </div>
</div>

<!-- Unique Visitors Popup -->
<div id="uniqueVisitorsModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Unique Visitors Details</h3>
            <span class="close-button" onclick="closeUniqueVisitorsPopup()">&times;</span>
        </div>
        <div class="modal-body">
            <div id="uniqueVisitorsLoading" class="loading" style="display: none;">Loading visitor details...</div>
            <div id="uniqueVisitorsContent">
                <table class="visitors-table">
                    <thead>
                        <tr>
                            <th>IP Address</th>
                            <th>Total Views</th>
                            <th>Last Visit</th>
                        </tr>
                    </thead>
                    <tbody id="uniqueVisitorsTableBody">
                        <!-- Content will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
// Global variables for analytics
let allVisits = [];
let filteredVisits = [];
let currentOffset = 0;
let pageSize = 50;
let isLoading = false;
let hasMoreVisits = true;
let intersectionObserver;
let backendTotalCount = 0;
let currentSortField = 'timestamp';
let currentSortOrder = 'desc';

// Toggle collapsible sections
window.toggleSection = function(sectionId) {
    const content = document.getElementById(sectionId);
    const icon = document.getElementById(sectionId + 'Icon');
    
    if (content.style.display === 'none') {
        content.style.display = 'block';
        icon.textContent = '▼';
    } else {
        content.style.display = 'none';
        icon.textContent = '▶';
    }
};

// Show unique visitors popup
window.showUniqueVisitorsPopup = async function() {
    const modal = document.getElementById('uniqueVisitorsModal');
    const loading = document.getElementById('uniqueVisitorsLoading');
    const tbody = document.getElementById('uniqueVisitorsTableBody');
    
    // Show modal and loading state
    modal.style.display = 'block';
    loading.style.display = 'block';
    tbody.innerHTML = '';
    
    try {
        // Get current time filter
        const timeFilter = document.getElementById('timeFilter').value;
        const days = timeFilter === '1h' ? 0.04 : 
                    timeFilter === '24h' ? 1 : 
                    timeFilter === '7d' ? 7 : 
                    timeFilter === '30d' ? 30 : 7;
        
        const response = await fetch(`/admin/analytics/unique-visitors?days=${days}`);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        // Populate table
        data.visitors.forEach(visitor => {
            const row = document.createElement('tr');
            const lastVisit = new Date(visitor.last_visit);
            const formattedLastVisit = lastVisit.toLocaleDateString() + ' ' + lastVisit.toLocaleTimeString();
            
            row.innerHTML = `
                <td>${visitor.ip_address}</td>
                <td>${visitor.total_views}</td>
                <td>${formattedLastVisit}</td>
            `;
            tbody.appendChild(row);
        });
        
    } catch (error) {
        console.error('Error loading unique visitors:', error);
        tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: red;">Error loading visitor data</td></tr>';
    } finally {
        loading.style.display = 'none';
    }
};

// Close unique visitors popup
window.closeUniqueVisitorsPopup = function() {
    document.getElementById('uniqueVisitorsModal').style.display = 'none';
};

// Refresh analytics data
window.refreshAnalytics = function() {
    currentOffset = 0;
    allVisits = [];
    filteredVisits = [];
    hasMoreVisits = true;
    document.getElementById('analyticsTableBody').innerHTML = '';
    loadVisits();
};

// Clear filters
window.clearFilters = function() {
    document.getElementById('searchBox').value = '';
    document.getElementById('timeFilter').value = '7d';
    reloadVisitsWithFilters();
};

// Check if any filters are active
function hasActiveFilters() {
    const searchValue = document.getElementById('searchBox').value.trim();
    const timeFilter = document.getElementById('timeFilter').value;
    return searchValue !== '' || timeFilter !== '7d';
}

// Update clear filters button visibility
function updateClearFiltersButtonVisibility() {
    const clearBtn = document.getElementById('clearFiltersBtn');
    if (hasActiveFilters()) {
        clearBtn.style.display = 'block';
    } else {
        clearBtn.style.display = 'none';
    }
}

// Load visits with pagination
async function loadVisits(append = false) {
    if (isLoading) return;
    
    isLoading = true;
    document.getElementById('loadingIndicator').style.display = 'block';
    
    try {
        // Build URL with sorting and filter parameters
        const params = new URLSearchParams({
            offset: append ? currentOffset : 0,
            limit: pageSize,
            sort_field: currentSortField,
            sort_order: currentSortOrder
        });
        
        // Add filter parameters
        const searchValue = document.getElementById('searchBox').value.trim();
        const timeFilter = document.getElementById('timeFilter').value;
        
        if (searchValue) params.append('search', searchValue);
        if (timeFilter) {
            // Convert time filter to days
            const days = timeFilter === '1h' ? 0.04 : 
                        timeFilter === '24h' ? 1 : 
                        timeFilter === '7d' ? 7 : 
                        timeFilter === '30d' ? 30 : 7;
            params.append('days', days);
        }
        
        const response = await fetch(`/admin/analytics/recent-visits?${params}`);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (!append) {
            allVisits = [];
            filteredVisits = [];
            currentOffset = 0;
        }
        
        if (data.visits && data.visits.length > 0) {
            backendTotalCount = data.total_count || 0;
            
            if (append) {
                allVisits = allVisits.concat(data.visits);
            } else {
                allVisits = data.visits;
                currentOffset = 0; // Reset offset for fresh loads
            }
            
            currentOffset += data.visits.length;
            hasMoreVisits = data.has_more;
            
            // Since backend handles filtering, filtered visits = all loaded visits
            filteredVisits = allVisits;
            
            updateDisplay();
            updateStats();
            updateClearFiltersButtonVisibility();
            
            if (!hasMoreVisits) {
                document.getElementById('noMoreVisits').style.display = 'block';
            }
        } else {
            hasMoreVisits = false;
            document.getElementById('noMoreVisits').style.display = 'block';
            if (!append) {
                // Clear the display if this is a fresh load with no results
                allVisits = [];
                filteredVisits = [];
                updateDisplay();
                updateStats();
            }
        }
        
    } catch (error) {
        console.error('Error loading visits:', error);
        document.getElementById('errorMessage').textContent = `Error loading visits: ${error.message}`;
        document.getElementById('errorMessage').style.display = 'block';
    } finally {
        isLoading = false;
        document.getElementById('loadingIndicator').style.display = 'none';
    }
}

// Update the table display
function updateDisplay() {
    const tbody = document.getElementById('analyticsTableBody');
    tbody.innerHTML = '';
    
    if (filteredVisits.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="6" style="text-align: center; padding: 20px;">No visits found</td>';
        tbody.appendChild(row);
        return;
    }
    
    filteredVisits.forEach(visit => {
        const row = document.createElement('tr');
        
        // Format timestamp
        const date = new Date(visit.timestamp);
        const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        
        // Calculate age
        const age = getTimeAgo(date);
        
        // Truncate long user agents
        const userAgent = visit.user_agent ? (visit.user_agent.length > 50 ? 
            visit.user_agent.substring(0, 50) + '...' : visit.user_agent) : '';
        
        // Truncate long referers
        const referer = visit.referer ? (visit.referer.length > 30 ? 
            visit.referer.substring(0, 30) + '...' : visit.referer) : '';
        
        // Format mouse activity indicator
        const mouseActivity = visit.mouse_activity ? '✓' : '🤖';
        const mouseTitle = visit.mouse_activity ? 'Human activity detected' : 'Likely bot (no mouse activity)';
        
        row.innerHTML = `
            <td class="compact-td" title="${visit.timestamp}">${formattedDate}</td>
            <td class="compact-td" title="${age}">${age}</td>
            <td class="compact-td" title="${visit.page_path}">${visit.page_path}</td>
            <td class="compact-td" title="${visit.ip_address}">${visit.ip_address}</td>
            <td class="compact-td" title="${mouseTitle}" style="text-align: center;">${mouseActivity}</td>
            <td class="compact-td" title="${visit.user_agent || ''}">${userAgent}</td>
            <td class="compact-td" title="${visit.referer || ''}">${referer}</td>
        `;
        
        tbody.appendChild(row);
    });
}

// Reload visits with current filters
function reloadVisitsWithFilters() {
    currentOffset = 0;
    allVisits = [];
    filteredVisits = [];
    hasMoreVisits = true;
    document.getElementById('analyticsTableBody').innerHTML = '';
    document.getElementById('noMoreVisits').style.display = 'none';
    document.getElementById('errorMessage').style.display = 'none';
    loadVisits();
}

// Render visits in table (deprecated - use updateDisplay instead)

// Get time ago string
function getTimeAgo(date) {
    const now = new Date();
    const diffMs = now - date;
    const diffMinutes = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMinutes / 60);
    const diffDays = Math.floor(diffHours / 24);
    
    if (diffMinutes < 1) return 'now';
    if (diffMinutes < 60) return `${diffMinutes}m`;
    if (diffHours < 24) return `${diffHours}h`;
    return `${diffDays}d`;
}

// Update stats
function updateStats() {
    document.getElementById('totalCount').textContent = `Total: ${backendTotalCount}`;
    document.getElementById('filteredVisits').textContent = `Loaded: ${allVisits.length}`;
    
    // Count unique IPs
    const uniqueIPs = new Set(allVisits.map(v => v.ip_address)).size;
    document.getElementById('uniqueVisitors').textContent = `Unique IPs: ${uniqueIPs}`;
}

// Reload visits with current filters
function reloadVisitsWithFilters() {
    currentOffset = 0;
    allVisits = [];
    filteredVisits = [];
    hasMoreVisits = true;
    document.getElementById('analyticsTableBody').innerHTML = '';
    document.getElementById('noMoreVisits').style.display = 'none';
    document.getElementById('errorMessage').style.display = 'none';
    loadVisits();
}

// Setup intersection observer for infinite scroll
function setupIntersectionObserver() {
    const scrollTrigger = document.getElementById('scrollTrigger');
    if (!scrollTrigger) return;
    
    intersectionObserver = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting && hasMoreVisits && !isLoading) {
            loadVisits(true);
        }
    }, { threshold: 0.1 });
    
    intersectionObserver.observe(scrollTrigger);
}

// Setup sorting
function setupSorting() {
    document.querySelectorAll('.sortable').forEach(header => {
        header.addEventListener('click', () => {
            const field = header.getAttribute('data-sort');
            if (currentSortField === field) {
                currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortField = field;
                currentSortOrder = 'desc';
            }
            
            // Update sort indicators
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.textContent = '';
            });
            header.querySelector('.sort-indicator').textContent = currentSortOrder === 'asc' ? '↑' : '↓';
            
            reloadVisitsWithFilters();
        });
    });
}

// Setup intersection observer for infinite scroll
function setupIntersectionObserver() {
    const scrollTrigger = document.getElementById('scrollTrigger');
    if (!scrollTrigger) return;
    
    intersectionObserver = new IntersectionObserver((entries) => {
        if (entries[0].isIntersecting && hasMoreVisits && !isLoading) {
            console.log('Loading more visits due to scroll');
            loadVisits(true);
        }
    }, { threshold: 0.1 });
    
    intersectionObserver.observe(scrollTrigger);
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    setupIntersectionObserver();
    setupSorting();
    
    // Setup filter event listeners
    document.getElementById('searchBox').addEventListener('input', 
        debounce(reloadVisitsWithFilters, 500));
    document.getElementById('timeFilter').addEventListener('change', reloadVisitsWithFilters);
    
    // Initial load
    loadVisits();
});

// Debounce function
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Enhanced daily views chart
const canvas = document.getElementById('dailyViewsChart');
const ctx = canvas.getContext('2d');

const dailyViews = {{ analytics.daily_views | tojson }};

function drawDailyViewsChart() {
    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    if (!dailyViews || dailyViews.length === 0) {
        // No data message
        ctx.fillStyle = '#666';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('No daily view data available', canvas.width/2, canvas.height/2);
        ctx.fillText('Select a longer time period to see trends', canvas.width/2, canvas.height/2 + 25);
        return;
    }
    
    // Chart dimensions
    const padding = 60;
    const chartWidth = canvas.width - (padding * 2);
    const chartHeight = canvas.height - (padding * 2);
    const maxViews = Math.max(...dailyViews.map(d => d.views), 1);
    const barWidth = chartWidth / dailyViews.length;
    
    // Draw background grid
    ctx.strokeStyle = '#f0f0f0';
    ctx.lineWidth = 1;
    for (let i = 0; i <= 5; i++) {
        const y = padding + (chartHeight * i / 5);
        ctx.beginPath();
        ctx.moveTo(padding, y);
        ctx.lineTo(canvas.width - padding, y);
        ctx.stroke();
    }
    
    // Draw bars
    dailyViews.forEach((day, index) => {
        const barHeight = (day.views / maxViews) * chartHeight;
        const x = padding + (index * barWidth);
        const y = canvas.height - padding - barHeight;
        
        // Bar background
        ctx.fillStyle = '#e3f2fd';
        ctx.fillRect(x + 2, canvas.height - padding - chartHeight, barWidth - 4, chartHeight);
        
        // Actual bar
        ctx.fillStyle = '#007acc';
        ctx.fillRect(x + 2, y, barWidth - 4, barHeight);
        
        // Bar border
        ctx.strokeStyle = '#005a9e';
        ctx.lineWidth = 1;
        ctx.strokeRect(x + 2, y, barWidth - 4, barHeight);
        
        // Date labels (rotate for better fit)
        ctx.save();
        ctx.translate(x + barWidth/2, canvas.height - padding + 15);
        ctx.rotate(-Math.PI / 4);
        ctx.fillStyle = '#333';
        ctx.font = '11px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(formatDateLabel(day.date), 0, 0);
        ctx.restore();
        
        // View count on top of bar
        if (day.views > 0) {
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(day.views, x + barWidth/2, y - 5);
        }
    });
    
    // Y-axis labels
    ctx.fillStyle = '#666';
    ctx.font = '11px Arial';
    ctx.textAlign = 'right';
    for (let i = 0; i <= 5; i++) {
        const value = Math.round(maxViews * (5 - i) / 5);
        const y = padding + (chartHeight * i / 5) + 4;
        ctx.fillText(value, padding - 10, y);
    }
    
    // Chart title
    ctx.fillStyle = '#333';
    ctx.font = 'bold 14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Daily Page Views', canvas.width/2, 25);
    
    // Y-axis title
    ctx.save();
    ctx.translate(20, canvas.height/2);
    ctx.rotate(-Math.PI/2);
    ctx.fillStyle = '#666';
    ctx.font = '12px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Views', 0, 0);
    ctx.restore();
}

function formatDateLabel(dateStr) {
    const date = new Date(dateStr);
    return (date.getMonth() + 1) + '/' + date.getDate();
}

// Draw the chart
drawDailyViewsChart();
</script>

<style>
.analytics-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.analytics-stats {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    flex: 1;
}

.stat-number {
    font-size: 2.5em;
    font-weight: bold;
    color: #007acc;
    margin: 10px 0;
}

.stat-period {
    color: #666;
    font-size: 0.9em;
}

.analytics-section {
    margin-bottom: 40px;
}

.analytics-section h2 {
    margin-bottom: 15px;
    color: #333;
}

.analytics-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
}

.analytics-table-container {
    border: 1px solid #ccc;
    border-radius: 6px;
    overflow: auto;
    background: #fff;
    height: calc(85vh - var(--header-height, 160px));
    min-height: 400px;
    max-height: 600px;
    width: 100%;
    max-width: 100%;
    margin-bottom: 0;
}

.analytics-table th,
.analytics-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.analytics-table th {
    background: #f5f5f5;
    font-weight: bold;
}

.analytics-table tr:hover {
    background: #f9f9f9;
}

.chart-container {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
}

.chart-description {
    color: #666;
    font-size: 14px;
    margin-bottom: 15px;
    font-style: italic;
}

#dailyViewsChart {
    border: 1px solid #eee;
}

/* Recent Visits Grid Styles */
.recent-visits-container {
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
}

.recent-visits-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
}

.visit-card {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    padding: 15px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.visit-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.visit-time {
    font-weight: bold;
    color: #007acc;
    font-size: 14px;
    margin-bottom: 8px;
}

.visit-page {
    font-size: 16px;
    color: #333;
    margin-bottom: 5px;
    word-break: break-all;
}

.visit-ip {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
}

.visit-user-agent {
    font-size: 11px;
    color: #888;
    font-style: italic;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.loading-indicator, .no-more-data {
    text-align: center;
    padding: 20px;
    color: #666;
    font-style: italic;
}

@media (max-width: 768px) {
    .recent-visits-grid {
        grid-template-columns: 1fr;
    }
}

/* Collapsible section styles */
.collapsible-header {
    cursor: pointer;
    user-select: none;
    margin-bottom: 10px;
    transition: color 0.2s ease;
}

.collapsible-header:hover {
    color: #007acc;
}

.toggle-icon {
    display: inline-block;
    margin-right: 8px;
    font-size: 12px;
    transition: transform 0.2s ease;
}

.collapsible-content {
    transition: all 0.3s ease;
}

/* Clickable stat styles */
.clickable-stat {
    cursor: pointer;
    transition: color 0.2s ease;
}

.clickable-stat:hover {
    color: #007acc;
    text-decoration: underline;
}

/* Modal popup styles */
.modal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 0;
    border-radius: 8px;
    width: 80%;
    max-width: 800px;
    max-height: 80vh;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.modal-header {
    background-color: #f5f5f5;
    padding: 15px 20px;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    color: #333;
}

.close-button {
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    color: #666;
    transition: color 0.2s ease;
}

.close-button:hover {
    color: #000;
}

.modal-body {
    padding: 20px;
    max-height: 60vh;
    overflow-y: auto;
}

.visitors-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

.visitors-table th,
.visitors-table td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.visitors-table th {
    background-color: #f8f9fa;
    font-weight: bold;
    color: #333;
}

.visitors-table tr:hover {
    background-color: #f5f5f5;
}
</style>
{% endblock %}