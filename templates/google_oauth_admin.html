<!DOCTYPE html>
<html class="no-js wf-freightsanspro-n3-active wf-freightsanspro-n9-active wf-freightsanspro-n4-active wf-freightsanspro-i9-active wf-freightdisplaypro-n7-active wf-freightdisplaypro-i7-active wf-active">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Google OAuth Administration - Daniel Blackburn</title>
    <script src="//ajax.googleapis.com/ajax/libs/dojo/1.14.1/dojo/dojo.js"></script>
    <link rel="stylesheet" href="/assets/style.css">

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-27877508-5');
    </script>
</head>

<body class="google-oauth-admin">
    <div class="wrap">
        <div class="fg">
            <!-- Include the navigation component -->
            {% with current_page='google_oauth_admin', user=user_info, user_authenticated=user_authenticated, user_email=user_email %}
                {% include 'navigation.html' %}
            {% endwith %}
            
            <div class="oauth-admin-content">
    <h2>Google OAuth Configuration</h2>
    
    <div class="admin-nav" style="margin-bottom: 20px;">
        <a href="/admin/google/oauth/tokens" class="btn-secondary" style="text-decoration: none; padding: 8px 16px;">
            ðŸ“‹ View OAuth Tokens
        </a>
    </div>
    
    <!-- Google OAuth Configuration Section -->
    <div class="config-section">
        <h3>Google OAuth Application</h3>
        
        <div id="google-status-display" class="status-not-configured">
            <strong>Status:</strong> <span id="google-status-text">Checking configuration...</span>
        </div>
        
        <div class="config-form">
            <form id="google-config-form">
                <div class="form-group">
                    <label for="google-app-name">Application Name:</label>
                    <input type="text" id="google-app-name" name="app_name" placeholder="My Google App" required>
                </div>
                
                <div class="form-group">
                    <label for="google-client-id">Client ID:</label>
                    <input type="text" id="google-client-id" name="client_id" placeholder="Google App Client ID" required>
                </div>
                
                <div class="form-group">
                    <label for="google-client-secret">Client Secret:</label>
                    <input type="text" id="google-client-secret" name="client_secret" placeholder="Google App Client Secret" required>
                </div>
                
                <div class="form-group">
                    <label for="google-redirect-uri">Redirect URI:</label>
                    <input type="url" id="google-redirect-uri" name="redirect_uri" 
                           placeholder="https://yourdomain.com/auth/callback" required>
                    <small>Must match exactly with your Google app configuration</small>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="save-google-config">Save Google Configuration</button>
                    <button type="button" class="btn-secondary" id="clear-google-config">Clear Configuration</button>
                </div>
            </form>
        </div>
        
        <div class="test-results" id="google-test-results" style="display: none;"></div>
    </div>
    
    <!-- Google API Scopes Information -->
    <div class="config-section">
        <h3>Required Google API Scopes</h3>
        <div class="scopes-status-info">
            <p><strong>Permission Status:</strong> The status below shows which permissions Google has actually granted. This updates automatically when you connect, and when you fetch Google data.</p>
        </div>
        <div class="scopes-list">
            <div class="scope-item required" id="scope-openid">
                <div class="scope-header">
                    <strong>Profile Access</strong>
                    <span class="scope-name">openid</span>
                    <span class="required-badge">Required</span>
                    <span class="permission-status" id="openid-status">
                        <span class="status-unknown">âšª Unknown</span>
                    </span>
                    <button id="revoke-openid" class="btn btn-sm btn-outline-danger revoke-scope-btn" style="display: none;" onclick="googleOAuthAdmin.revokeScope('openid')">Revoke</button>
                </div>
                <div class="scope-description">Access to basic profile information</div>
                <div class="scope-data-access">Provides: <span id="openid-data">User ID, basic profile</span></div>
            </div>
            
            <div class="scope-item required" id="scope-email">
                <div class="scope-header">
                    <strong>Email Access</strong>
                    <span class="scope-name">email</span>
                    <span class="required-badge">Required</span>
                    <span class="permission-status" id="email-status">
                        <span class="status-unknown">âšª Unknown</span>
                    </span>
                    <button id="revoke-email" class="btn btn-sm btn-outline-danger revoke-scope-btn" style="display: none;" onclick="googleOAuthAdmin.revokeScope('email')">Revoke</button>
                </div>
                <div class="scope-description">Access to email address</div>
                <div class="scope-data-access">Provides: <span id="email-data">Primary email address</span></div>
            </div>
            
            <div class="scope-item required" id="scope-profile">
                <div class="scope-header">
                    <strong>Profile Data</strong>
                    <span class="scope-name">profile</span>
                    <span class="required-badge">Required</span>
                    <span class="permission-status" id="profile-status">
                        <span class="status-unknown">âšª Unknown</span>
                    </span>
                    <button id="revoke-profile" class="btn btn-sm btn-outline-danger revoke-scope-btn" style="display: none;" onclick="googleOAuthAdmin.revokeScope('profile')">Revoke</button>
                </div>
                <div class="scope-description">Access to detailed profile information</div>
                <div class="scope-data-access">Provides: <span id="profile-data">Name, profile picture, locale</span></div>
            </div>
            
            <div class="scope-item optional" id="scope-gmail-send">
                <div class="scope-header">
                    <strong>Gmail Send</strong>
                    <span class="scope-name">https://www.googleapis.com/auth/gmail.send</span>
                    <span class="optional-badge">Optional</span>
                    <span class="permission-status" id="gmail-send-status">
                        <span class="status-unknown">âšª Unknown</span>
                    </span>
                    <button id="revoke-gmail-send" class="btn btn-sm btn-outline-danger revoke-scope-btn" style="display: none;" onclick="googleOAuthAdmin.revokeScope('gmail.send')">Revoke</button>
                </div>
                <div class="scope-description">Send emails on behalf of the user (for contact form notifications)</div>
                <div class="scope-data-access">Provides: <span id="gmail-send-data">Ability to send emails through Gmail API</span></div>
                <div class="scope-note">
                    <small><strong>Note:</strong> This permission requires separate authorization and is only needed for automatic email notifications from the contact form.</small>
                </div>
            </div>
        </div>
        
        <div class="config-actions">
            <button type="button" class="btn-primary" id="test-profile-access">Fetch Google Data</button>
            <button type="button" class="btn-secondary" id="initiate-google-oauth" title="Click to grant Google OAuth permissions">Authorize Google Access</button>
        </div>
        
        <div class="authorization-info">
            <small><strong>Note:</strong> The "Authorize Google Access" button will be hidden when all required permissions are already granted.</small>
        </div>
    </div>
</div>

<!-- Result Messages -->
<div class="result-messages" id="result-messages"></div>

<script src="/assets/js/google-oauth-admin.js"></script>
        </div>
    </div>
</body>
</html>
