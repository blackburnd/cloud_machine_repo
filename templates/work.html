<!DOCTYPE html>
<html
    class="no-js wf-freightsanspro-n3-active wf-freightsanspro-n9-active wf-freightsanspro-n4-active wf-freightsanspro-i9-active wf-freightdisplaypro-n7-active wf-freightdisplaypro-i7-active wf-active">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ title }}</title>
    <script src="//ajax.googleapis.com/ajax/libs/dojo/1.14.1/dojo/dojo.js"></script>
    <link rel="stylesheet" href="/templates/style.css">

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-27877508-5');
    </script>
</head>

<body class="work">
    <div class="wrap">
        <div class="fg">
            <!-- Include the navigation component with current page set to 'work' -->
            {% with current_page='work', user=user_info, user_authenticated=user_authenticated, user_email=user_email %}
                {% include 'navigation.html' %}
            {% endwith %}
                            <div>
                                <a href="/auth/logout" class="auth-link logout-link">Logout ({{ user_email }})</a>
                                <div class="admin-links">
                                    <a href="/workadmin" class="admin-link">Work Admin</a>
                                    <a href="/workadmin/bulk" class="admin-link">Bulk Edit</a>
                                    <a href="/debug/logs" class="admin-link">Logs</a>
                                </div>
                            </div>
                        {% else %}
                            <a href="/auth/login" class="auth-link">Login</a>
                        {% endif %}
                    </div>
                </nav>
            </header>
            <div id="bw" aria-live="polite">
                <article class="bc clearfix">
                    <section class="work-content">
                        <h2>My Work</h2>
                        <p>Here's a collection of my professional experience and selected projects. I specialize in cloud technologies, automation, and modern web development.</p>

                        <div id="work-container">
                            <div class="loading">Loading work experience and projects...</div>
                        </div>
                    </section>
                </article>
            </div><!-- barba wrapper -->
            <footer class="footer" role="contentinfo">
                <p class="copyright">© 2025 Blackburn.</p>
            </footer>
        </div><!-- #fg -->
    </div><!-- .wrap -->

    <script>
        // GraphQL query to fetch portfolio data
        const query = `
            query GetPortfolio {
                portfolio {
                    workExperience {
                        id
                        company
                        position
                        location
                        startDate
                        endDate
                        description
                        isCurrent
                        companyUrl
                    }
                    projects {
                        id
                        title
                        description
                        url
                        technologies
                    }
                }
            }
        `;

        async function loadWorkData() {
            const container = document.getElementById('work-container');
            
            try {
                const response = await fetch('/graphql', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query })
                });

                const result = await response.json();
                
                if (result.errors) {
                    throw new Error(result.errors[0].message);
                }

                const portfolio = result.data.portfolio;
                if (!portfolio) {
                    throw new Error('No portfolio data found');
                }

                let html = '';

                // Work Experience Section
                if (portfolio.workExperience && portfolio.workExperience.length > 0) {
                    html += '<div class="work-section"><h2>Work Experience</h2>';
                    portfolio.workExperience.forEach(work => {
                        const currentBadge = work.isCurrent ? '<span class="current-badge">Current</span>' : '';
                        const dateRange = work.endDate ? `${work.startDate} - ${work.endDate}` : `${work.startDate} - Present`;
                        const companyLink = work.companyUrl ? `<a href="${work.companyUrl}" target="_blank">${work.company}</a>` : work.company;
                        
                        html += `
                            <div class="work-item">
                                <h3>${work.position}${currentBadge}</h3>
                                <div class="work-meta">
                                    ${companyLink} • ${work.location || 'Remote'} • ${dateRange}
                                </div>
                                <p>${work.description || ''}</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                }

                // Projects Section
                if (portfolio.projects && portfolio.projects.length > 0) {
                    html += '<div class="work-section"><h2>Featured Projects</h2>';
                    portfolio.projects.forEach(project => {
                        const projectLink = project.url ? `<a href="${project.url}" target="_blank">${project.title}</a>` : project.title;
                        const techTags = project.technologies && project.technologies.length > 0 
                            ? project.technologies.map(tech => `<span class="tech-tag">${tech}</span>`).join('')
                            : '';
                        
                        html += `
                            <div class="project-item">
                                <h3>${projectLink}</h3>
                                <p>${project.description}</p>
                                ${techTags ? `<div class="tech-tags">${techTags}</div>` : ''}
                            </div>
                        `;
                    });
                    html += '</div>';
                }

                if (!html) {
                    html = '<div class="error">No work experience or projects found.</div>';
                }

                container.innerHTML = html;

            } catch (error) {
                console.error('Error loading work data:', error);
                container.innerHTML = `<div class="error">Error loading work data: ${error.message}</div>`;
            }
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadWorkData);
    </script>
</body>

</html>