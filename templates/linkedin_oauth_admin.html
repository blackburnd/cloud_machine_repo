{% extends "base.html" %}

{% block title %}LinkedIn OAuth Administration - Daniel Blackburn{% endblock %}

{% block body_class %}linkedin-oauth-admin{% endblock %}

{% block content %}
<div class="oauth-admin-content">
    <h2>LinkedIn OAuth Configuration</h2>
    
    <!-- LinkedIn OAuth Configuration Section -->
    <div class="config-section">
        <h3>LinkedIn OAuth Application</h3>
        
        <div id="linkedin-status-display" class="status-not-configured">
            <strong>Status:</strong> <span id="linkedin-status-text">Checking configuration...</span>
        </div>
        
        <div class="config-form">
            <form id="linkedin-config-form">
                <div class="form-group">
                    <label for="linkedin-app-name">Application Name:</label>
                    <input type="text" id="linkedin-app-name" name="app_name" placeholder="My LinkedIn App" required>
                </div>
                
                <div class="form-group">
                    <label for="linkedin-client-id">Client ID:</label>
                    <input type="text" id="linkedin-client-id" name="client_id" placeholder="LinkedIn App Client ID" required>
                </div>
                
                <div class="form-group">
                    <label for="linkedin-client-secret">Client Secret:</label>
                    <input type="text" id="linkedin-client-secret" name="client_secret" placeholder="LinkedIn App Client Secret" required>
                </div>
                
                <div class="form-group">
                    <label for="linkedin-redirect-uri">Redirect URI:</label>
                    <input type="url" id="linkedin-redirect-uri" name="redirect_uri" 
                           placeholder="https://yourdomain.com/admin/linkedin/oauth/callback" required>
                    <small>Must match exactly with your LinkedIn app configuration</small>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="save-linkedin-config">Save LinkedIn Configuration</button>
                    <button type="button" class="btn-test" id="test-linkedin-connection">Test Connection</button>
                    <button type="button" class="btn-secondary" id="clear-linkedin-config">Clear Configuration</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- LinkedIn API Scopes Information -->
    <div class="config-section">
        <h3>Required LinkedIn API Scopes</h3>
        <div class="scopes-status-info">
            <p><strong>Permission Status:</strong> The status below shows which permissions LinkedIn has actually granted. This updates automatically when you connect, and when you fetch LinkedIn data.</p>
        </div>
        <div class="scopes-list">
            <div class="scope-item required" id="scope-r_liteprofile">
                <div class="scope-header">
                    <strong>Profile Access</strong>
                    <span class="scope-name">r_liteprofile</span>
                    <span class="required-badge">Required</span>
                    <span class="permission-status" id="r_liteprofile-status">
                        <span class="status-unknown">⚪ Unknown</span>
                    </span>
                    <button id="revoke-r_liteprofile" class="btn btn-sm btn-outline-danger revoke-scope-btn" style="display: none;" onclick="linkedInOAuthAdmin.revokeScope('r_liteprofile')">Revoke</button>
                </div>
                <div class="scope-description">Access to basic profile information</div>
                <div class="scope-data-access">Provides: <span id="r_liteprofile-data">Name, profile picture, headline</span></div>
            </div>
            
            <div class="scope-item required" id="scope-r_emailaddress">
                <div class="scope-header">
                    <strong>Email Access</strong>
                    <span class="scope-name">r_emailaddress</span>
                    <span class="required-badge">Required</span>
                    <span class="permission-status" id="r_emailaddress-status">
                        <span class="status-unknown">⚪ Unknown</span>
                    </span>
                    <button id="revoke-r_emailaddress" class="btn btn-sm btn-outline-danger revoke-scope-btn" style="display: none;" onclick="linkedInOAuthAdmin.revokeScope('r_emailaddress')">Revoke</button>
                </div>
                <div class="scope-description">Access to primary email address</div>
                <div class="scope-data-access">Provides: <span id="r_emailaddress-data">Primary email address</span></div>
            </div>
            
            <div class="scope-item optional" id="scope-r_fullprofile">
                <div class="scope-header">
                    <strong>Position Data</strong>
                    <span class="scope-name">r_fullprofile</span>
                    <span class="optional-badge">Optional</span>
                    <span class="permission-status" id="r_fullprofile-status">
                        <span class="status-unknown">⚪ Unknown</span>
                    </span>
                    <button id="revoke-r_fullprofile" class="btn btn-sm btn-outline-danger revoke-scope-btn" style="display: none;" onclick="linkedInOAuthAdmin.revokeScope('r_fullprofile')">Revoke</button>
                </div>
                <div class="scope-description">Access to detailed profile and position information</div>
                <div class="scope-data-access">Provides: <span id="r_fullprofile-data">Work experience, education, skills</span></div>
                <div class="scope-note">
                    <small><strong>Note:</strong> This permission provides access to detailed work history and professional information.</small>
                </div>
            </div>
        </div>
        
        <div class="config-actions">
            <button type="button" class="btn-primary" id="test-profile-access">Fetch LinkedIn Data</button>
            <button type="button" class="btn-secondary" id="initiate-linkedin-oauth" title="Click to grant LinkedIn OAuth permissions">Authorize LinkedIn Access</button>
        </div>
        
        <div class="authorization-info">
            <small><strong>Note:</strong> The "Authorize LinkedIn Access" button will be hidden when all required permissions are already granted.</small>
        </div>
    </div>
    
    <!-- LinkedIn OAuth Connection Status -->
    <div class="config-section">
        <h3>Current LinkedIn Connection</h3>
        <div id="linkedin-connection-status" class="status-not-configured">
            <strong>Connection Status:</strong> <span id="linkedin-connection-text">No active connection</span>
        </div>
        
        <div id="linkedin-connection-details" style="display: none;">
            <p><strong>Connected Account:</strong> <span id="linkedin-account-email">-</span></p>
            <p><strong>Last Sync:</strong> <span id="linkedin-last-sync">-</span></p>
            <p><strong>Token Expires:</strong> <span id="linkedin-token-expiry">-</span></p>
        </div>
        
        <div class="test-results" id="linkedin-test-results" style="display: none;"></div>
    </div>
</div>

<!-- Result Messages -->
<div class="result-messages" id="result-messages"></div>

<script src="/assets/js/linkedin-oauth-admin.js"></script>
{% endblock %}
